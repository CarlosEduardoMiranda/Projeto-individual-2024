<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>
    <link rel="stylesheet" href="./css/menu.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link REL="SHORTCUT ICON" HREF="./assets/imgs/Corinthians.webp">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body onload="listarTentativa(sessionStorage.ID_USUARIO)">


    <header>
        <img src="./assets/imgs/Corinthians.webp" alt="Corinthians Logo" class="logo">
        <span class="player">Username:<p id="nome"></p></span>
        <span class="time">Tempo Record:<p id="tempo"></p></span>
    </header>

    <nav class="menu-lateral">
        <div class="btn-expandir">
            <!-- <i class="bi bi-list" id="btn-exp"></i> -->
        </div>

        <ul>
            <li class="item-menu ativo">
                <a href="#">
                    <span class="icon"><i class="bi bi-house-door"></i></span>
                    <span class="txt-link">Home</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="">
                    <span class="icon"><i class="bi bi-question-diamond"></i></span>
                    <span class="txt-link">Quiz</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="./jogoMemoria.html">
                    <span class="icon"><i class="bi bi-controller"></i></span>
                    <span class="txt-link">Jogo</span>
                </a>
            </li>
            <li class="item-menu">
                <a href="">
                    <span class="icon"><i class="bi bi-columns-gap"></i></span>
                    <span class="txt-link">Dashboard</span>
                </a>
            </li>
        </ul>

    </nav>

    <div class="dashboard">
        <div class="container">
            <div class="stats-and-charts">
                <!-- Ranking com 10 pessoas -->
                <div class="ranking">
                    <h3>Ranking</h3>
                    <ol>
                        <li><span class="rank-position">1.</span> João - <span class="rank-time">1m 45s</span></li>
                        <li><span class="rank-position">2.</span> Maria - <span class="rank-time">1m 50s</span></li>
                        <li><span class="rank-position">3.</span> Pedro - <span class="rank-time">2m 00s</span></li>
                        <li><span class="rank-position">4.</span> Ana - <span class="rank-time">2m 10s</span></li>
                        <li><span class="rank-position">5.</span> Carlos - <span class="rank-time">2m 30s</span></li>
                        <li><span class="rank-position">6.</span> Lucas - <span class="rank-time">2m 35s</span></li>
                        <li><span class="rank-position">7.</span> Julia - <span class="rank-time">2m 40s</span></li>
                        <li><span class="rank-position">8.</span> Rafael - <span class="rank-time">2m 50s</span></li>
                        <li><span class="rank-position">9.</span> Fernanda - <span class="rank-time">3m 00s</span></li>
                        <li><span class="rank-position">10.</span> Bruno - <span class="rank-time">3m 10s</span></li>
                    </ol>
                </div>

                <div class="container-pai">
                    <!-- Card para a Posição no Ranking Atual -->
                    <div class="container-estatística">
                        <div class="card-estatística">
                            <h3>Posição no Ranking Atual</h3>
                            <p>Você está atualmente na posição: <strong>5</strong></p>
                        </div>
                    </div>

                    <!-- Card para a Média de Tempo -->
                    <div class="container-estatística">
                        <div class="card-estatística">
                            <h3>Média de Tempo</h3>
                            <p>Sua média de tempo é: <strong>2m 30s</strong></p>
                        </div>
                    </div>
                </div>

                <div class="charts">
                    <div class="dash-cima">
                        <div class="card">
                            <canvas id="myChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    <div class="dash-baixo">
                        <div class="card">
                            <canvas id="myChart2" width="400" height="200"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="./js/menu.js"></script>
</body>

</html>
<script>

    let Username = sessionStorage.getItem('USERNAME_USUARIO')
    const addnome = document.getElementById('nome')
    addnome.innerHTML = Username

    let tempoRecord = sessionStorage.getItem('TEMPO_USUARIO')
    const addtempo = document.getElementById('tempo')
    addtempo.innerHTML = tempoRecord

    // let tempoJogadas = sessionStorage.getItem('')
    // const addjogadas = document.getElementById('')

    var contClick = 0;

    const ctx = document.getElementById('myChart2');
    const ctz = document.getElementById('myChart');

    var ctx1 = document.getElementById('myChart').getContext('2d');
    var myChart = new Chart(ctx1, {
        type: 'line',
        data: {
            labels: [], // Labels vazias
            datasets: [{
                label: 'Tempo em segundos',
                data: [], // Dados vazios
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            maintainAspectRatio: false, // Permite alterar a proporção do gráfico
            responsive: true
        }
    });

    let idUsuario =  sessionStorage.ID_USUARIO 

    function listarTentativa(idUsuario) {
        let novosDados;

        fetch(`/medidas/listarTentativa`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                idusuarioServer: idUsuario
            }),
        })
            .then(function (resultado) {
               if (resultado.ok) {
                resultado.json().then(function (resultado) {
                    resultado.reverse();
                    atualizarGrafico(resultado); 
            });
        }
            })
            .catch(function (resultado){
                console.log(`#ERRO: ${resultado}`)
            });
    }


    function atualizarGrafico(resultado){
        myChart.data.datasets[0].data = []
        myChart.data.labels = []
        for (var posicao = 0; posicao < resultado.length; posicao++) {
        let UltimoDado = resultado[posicao];
        console.log(UltimoDado.tempo)
        myChart.data.datasets[0].data.push(UltimoDado.tempo);
        myChart.data.labels.push(`Tentativa  ${posicao + 1}`);
        myChart.update();
    }
    }

    setInterval(listarTentativa(), 3000);

    // var ctx2 = document.getElementById('myChart2').getContext('2d');
    // var myChart2 = new Chart(ctx2, {
    //     type: 'line',
    //     data: {
    //         labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
    //         datasets: [{
    //             label: 'My First dataset',
    //             backgroundColor: 'rgb(255, 99, 132)',
    //             borderColor: 'rgb(255, 99, 132)',
    //             data: [0, 10, 5, 2, 20, 30, 45]
    //         }]
    //     },
    //     options: {
    //         maintainAspectRatio: false, // permite alterar a proporção do gráfico
    //         responsive: true,
    //         // outras opções de configuração
    //     }
    // });


</script>